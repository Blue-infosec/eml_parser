pipeline {
  agent any
  options {
    ansiColor('xterm')
    timestamps()
    timeout(time: 1, unit: 'HOURS')
  }

  stages {
    stage('Lint') {
      steps {
        sh "tox"
      }
    }

   stage('Analysis - pylint') {
      steps {
        script { analyze_pylint() }
      }
    }

   stage('Analysis - pyflakes') {
      steps {
        script { analyze_pyflakes() }
      }
    }

    stage('Test results') {
      steps {
        junit '**/junit-*.xml'
      }
    }
  }
}


def analyze_pylint() {
      step([$class: 'WarningsPublisher', canComputeNew: false, canResolveRelativePaths: false, defaultEncoding: '', excludePattern: '', healthy: '', includePattern: '', messagesPattern: '', parserConfigurations: [[parserName: 'PyLint', pattern: 'pylint.log']], unHealthy: ''])
}


def analyze_pyflakes() {
      step([$class: 'WarningsPublisher', canComputeNew: false, canResolveRelativePaths: false, defaultEncoding: '', excludePattern: '', healthy: '', includePattern: '', messagesPattern: '', parserConfigurations: [[parserName: 'PyFlakes', pattern: 'pyflakes.log']], unHealthy: ''])
}
